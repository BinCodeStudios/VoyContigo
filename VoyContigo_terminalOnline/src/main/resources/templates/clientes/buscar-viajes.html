<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Buscar Viajes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
<div class="container mx-auto p-6">
    <!-- Información del usuario -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Buscar Viajes</h1>
        <div class="text-right">
            <p th:if="${usuarioNombre != 'Invitado'}" class="text-lg font-semibold">
                Bienvenido, <span th:text="${usuarioNombre}"></span> (<span th:text="${usuarioCorreo}"></span>)
            </p>
            <p th:if="${usuarioNombre == 'Invitado'}" class="text-lg font-semibold">
                <a th:href="@{/user/clientes/loginclientes}" class="text-blue-600 hover:underline">Iniciar sesión</a>
            </p>
        </div>
    </div>

    <!-- Mensaje de error (si existe) -->
    <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6">
        <span th:text="${error}"></span>
    </div>

    <!-- Formulario de búsqueda -->
    <form th:action="@{/clientes/viajes/buscar}" method="get" class="bg-white rounded-lg shadow-md p-6 mb-6">
        <input type="hidden" name="clienteId" th:value="${clienteId}">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- Origen -->
            <div>
                <label for="origen" class="block text-sm font-medium text-gray-700">Origen</label>
                <select id="origen" name="origen" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    <option value="">Seleccione un origen</option>
                    <option th:each="origen : ${origenes}" 
                            th:value="${origen.nombre}" 
                            th:text="${origen.nombre}"></option>
                </select>
            </div>
            <!-- Destino -->
            <div>
                <label for="destino" class="block text-sm font-medium text-gray-700">Destino</label>
                <select id="destino" name="destino" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    <option value="">Seleccione un destino</option>
                    <option th:each="destino : ${destinos}" 
                            th:value="${destino.nombre}" 
                            th:text="${destino.nombre}"></option>
                </select>
            </div>
            <!-- Flota -->
            <div>
                <label for="flota" class="block text-sm font-medium text-gray-700">Flota</label>
                <select id="flota" name="flota" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    <option value="">Seleccione una flota</option>
                    <option th:each="flota : ${flotas}" 
                            th:value="${flota.nombre}" 
                            th:text="${flota.nombre}"></option>
                </select>
            </div>
            <!-- Fecha -->
            <div>
                <label for="fecha" class="block text-sm font-medium text-gray-700">Fecha</label>
                <input type="datetime-local" id="fecha" name="fecha" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
            </div>
        </div>
        <button type="submit" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Filtrar</button>
    </form>

    <!-- Resultados de búsqueda -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4">Viajes Disponibles</h2>
        <div th:if="${not #lists.isEmpty(viajes)}">
            <div th:each="viaje : ${viajes}" class="border-b py-4">
                <h3 class="text-lg font-medium" th:text="${viaje.origen?.nombre} + ' - ' + ${viaje.destino?.nombre}"></h3>
                <p class="text-gray-600" th:text="'Flota: ' + ${viaje.flota?.nombre ?: 'N/A'}"></p>
                <p class="text-gray-600" th:text="'Salida: ' + ${viaje.fechaSalida ?: 'N/A'}"></p>
                <p class="text-gray-600" th:text="'Precio: $' + ${viaje.ruta?.precio ?: 0}"></p>
                <a th:href="@{/clientes/viajes/detalles/{id}(id=${viaje.id},clienteId=${clienteId})}" 
                   class="text-blue-600 hover:underline">Ver detalles</a>
            </div>
        </div>
        <p th:if="${#lists.isEmpty(viajes)}" class="text-gray-600">No se encontraron viajes.</p>
    </div>
</div>
</body>
</html>